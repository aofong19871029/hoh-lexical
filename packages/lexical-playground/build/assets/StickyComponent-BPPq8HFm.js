import{ab as e,r as t,ac as n,u as o,o as s,t as r,j as l,a3 as a,_ as i,V as c,W as u,ad as d,Z as f,a0 as g,S as p,ae as m}from"./main-CoHkeVoD.js";import{d as y}from"./LexicalNestedComposer-Clp-L95x.js";const v=e?t.useLayoutEffect:t.useEffect,x={...n,paragraph:"StickyEditorTheme__paragraph"};function E(e,t){const n=e.style,o=t.rootElementRect,s=null!==o?o.left:0,r=null!==o?o.top:0;n.top=r+t.y+"px",n.left=s+t.x+"px"}function h({x:e,y:n,nodeKey:h,color:b,caption:j}){const[R]=o(),C=t.useRef(null),L=t.useRef({isDragging:!1,offsetX:0,offsetY:0,rootElementRect:null,x:0,y:0}),{isCollabActive:k}=s();t.useEffect((()=>{const t=L.current;t.x=e,t.y=n;const o=C.current;null!==o&&E(o,t)}),[e,n]),v((()=>{const e=L.current,t=new ResizeObserver((t=>{for(let n=0;n<t.length;n++){const o=t[n],{target:s}=o;e.rootElementRect=s.getBoundingClientRect();const r=C.current;null!==r&&E(r,e)}})),n=R.registerRootListener(((e,n)=>{null!==n&&t.unobserve(n),null!==e&&t.observe(e)})),o=()=>{const t=R.getRootElement(),n=C.current;null!==t&&null!==n&&(e.rootElementRect=t.getBoundingClientRect(),E(n,e))};return window.addEventListener("resize",o),()=>{window.removeEventListener("resize",o),n()}}),[R]),t.useEffect((()=>{const e=C.current;null!==e&&setTimeout((()=>{e.style.setProperty("transition","top 0.3s ease 0s, left 0.3s ease 0s")}),500)}),[]);const N=e=>{const t=C.current,n=L.current,o=n.rootElementRect,s=a(t);null!==t&&n.isDragging&&null!==o&&(n.x=e.pageX/s-n.offsetX-o.left,n.y=e.pageY/s-n.offsetY-o.top,E(t,n))},D=e=>{const t=C.current,n=L.current;null!==t&&(n.isDragging=!1,t.classList.remove("dragging"),R.update((()=>{const e=p(h);m(e)&&e.setPosition(n.x,n.y)}))),document.removeEventListener("pointermove",N),document.removeEventListener("pointerup",D)},{historyState:w}=r();return l.jsx("div",{ref:C,className:"sticky-note-container",children:l.jsxs("div",{className:`sticky-note ${b}`,onPointerDown:e=>{const t=C.current;if(null==t||2===e.button||e.target!==t.firstChild)return;const n=t,o=L.current;if(null!==n){const{top:t,left:s}=n.getBoundingClientRect(),r=a(n);o.offsetX=e.clientX/r-s,o.offsetY=e.clientY/r-t,o.isDragging=!0,n.classList.add("dragging"),document.addEventListener("pointermove",N),document.addEventListener("pointerup",D),e.preventDefault()}},children:[l.jsx("button",{onClick:()=>{R.update((()=>{const e=p(h);m(e)&&e.remove()}))},className:"delete","aria-label":"Delete sticky note",title:"Delete",children:"X"}),l.jsx("button",{onClick:()=>{R.update((()=>{const e=p(h);m(e)&&e.toggleColor()}))},className:"color","aria-label":"Change sticky note color",title:"Color",children:l.jsx("i",{className:"bucket"})}),l.jsxs(y,{initialEditor:j,initialTheme:x,children:[k?l.jsx(i,{id:j.getKey(),providerFactory:c,shouldBootstrap:!0}):l.jsx(u,{externalHistoryState:w}),l.jsx(d,{contentEditable:l.jsx(f,{placeholder:"What's up?",placeholderClassName:"StickyNode__placeholder",className:"StickyNode__contentEditable"}),ErrorBoundary:g})]})]})})}export{h as default};
