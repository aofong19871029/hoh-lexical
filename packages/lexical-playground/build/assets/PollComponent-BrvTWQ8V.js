import{u as e,r as o,k as t,O as s,x as n,a8 as l,b as a,m as i,F as d,w as r,n as c,j as p,B as u,o as h,a9 as N,S as _,aa as m}from"./main-CoHkeVoD.js";function x({option:e,index:t,options:s,totalVotes:n,withPollNode:l}){const{clientID:a}=h(),i=o.useRef(null),d=e.votes,r=-1!==d.indexOf(a),c=d.length,u=e.text;return p.jsxs("div",{className:"PollNode__optionContainer",children:[p.jsx("div",{className:N("PollNode__optionCheckboxWrapper",r&&"PollNode__optionCheckboxChecked"),children:p.jsx("input",{ref:i,className:"PollNode__optionCheckbox",type:"checkbox",onChange:o=>{l((o=>{o.toggleVote(e,a)}))},checked:r})}),p.jsxs("div",{className:"PollNode__optionInputWrapper",children:[p.jsx("div",{className:"PollNode__optionInputVotes",style:{width:(0===c?0:c/n*100)+"%"}}),p.jsx("span",{className:"PollNode__optionInputVotesCount",children:c>0&&(1===c?"1 vote":`${c} votes`)}),p.jsx("input",{className:"PollNode__optionInput",type:"text",value:u,onChange:o=>{const t=o.target,s=t.value,n=t.selectionStart,a=t.selectionEnd;l((o=>{o.setOptionText(e,s)}),(()=>{t.selectionStart=n,t.selectionEnd=a}))},placeholder:`Option ${t+1}`})]}),p.jsx("button",{disabled:s.length<3,className:N("PollNode__optionDelete",s.length<3&&"PollNode__optionDeleteDisabled"),"aria-label":"Remove",onClick:()=>{l((o=>{o.deleteOption(e)}))}})]})}function f({question:h,options:N,nodeKey:f}){const[g]=e(),j=o.useMemo((()=>function(e){return e.reduce(((e,o)=>e+o.votes.length),0)}(N)),[N]),[v,P,C]=t(f),[k,b]=o.useState(null),O=o.useRef(null),y=o.useCallback((e=>{const o=s();if(v&&n(o)){e.preventDefault(),g.update((()=>{o.getNodes().forEach((e=>{l(e)&&e.remove()}))}))}return!1}),[g,v]);o.useEffect((()=>a(g.registerUpdateListener((({editorState:e})=>{b(e.read((()=>s())))})),g.registerCommand(c,(e=>{const o=e;return o.target===O.current&&(o.shiftKey||C(),P(!v),!0)}),d),g.registerCommand(r,y,d),g.registerCommand(i,y,d))),[C,g,v,f,y,P]);const D=(e,o)=>{g.update((()=>{const o=_(f);l(o)&&e(o)}),{onUpdate:o})},I=n(k)&&v;return p.jsx("div",{className:"PollNode__container "+(I?"focused":""),ref:O,children:p.jsxs("div",{className:"PollNode__inner",children:[p.jsx("h2",{className:"PollNode__heading",children:h}),N.map(((e,o)=>{const t=e.uid;return p.jsx(x,{withPollNode:D,option:e,index:o,options:N,totalVotes:j},t)})),p.jsx("div",{className:"PollNode__footer",children:p.jsx(u,{onClick:()=>{D((e=>{e.addOption(m())}))},small:!0,children:"Add Option"})})]})})}export{f as default};
