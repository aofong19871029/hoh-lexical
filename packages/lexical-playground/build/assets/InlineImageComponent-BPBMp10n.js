import{j as e,a4 as t,r as a,k as s,u as n,O as l,x as i,a5 as r,q as o,b as c,a as d,F as u,T as m,m as h,w as p,s as g,n as x,e as f,J as j,P as C,Y as b,Z as v,a0 as N,S as w,a6 as E,a7 as k,B as y}from"./main-CGNrK9TK.js";import{d as S}from"./LexicalNestedComposer-iPxZfwmB.js";function I({children:t,label:a,className:s,...n}){return e.jsxs("div",{className:"Input__wrapper",children:[e.jsx("label",{style:{marginTop:"-1em"},className:"Input__label",children:a}),e.jsx("select",{...n,className:s||"select",children:t})]})}const _=new Set;function R({altText:t,className:a,imageRef:s,src:n,width:l,height:i,position:r}){return function(e){if(!_.has(e))throw new Promise((t=>{const a=new Image;a.src=e,a.onload=()=>{_.add(e),t(null)}}))}(n),e.jsx("img",{className:a||void 0,src:n,alt:t,ref:s,"data-position":r,style:{display:"block",height:i,width:l},draggable:"false"})}function T({activeEditor:t,nodeKey:s,onClose:n}){const l=t.getEditorState().read((()=>w(s))),[i,r]=a.useState(l.getAltText()),[o,c]=a.useState(l.getShowCaption()),[d,u]=a.useState(l.getPosition());return e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginBottom:"1em"},children:e.jsx(E,{label:"Alt Text",placeholder:"Descriptive alternative text",onChange:r,value:i,"data-test-id":"image-modal-alt-text-input"})}),e.jsxs(I,{style:{marginBottom:"1em",width:"208px"},value:d,label:"Position",name:"position",id:"position-select",onChange:e=>{u(e.target.value)},children:[e.jsx("option",{value:"left",children:"Left"}),e.jsx("option",{value:"right",children:"Right"}),e.jsx("option",{value:"full",children:"Full Width"})]}),e.jsxs("div",{className:"Input__wrapper",children:[e.jsx("input",{id:"caption",type:"checkbox",checked:o,onChange:e=>{c(e.target.checked)}}),e.jsx("label",{htmlFor:"caption",children:"Show Caption"})]}),e.jsx(k,{children:e.jsx(y,{"data-test-id":"image-modal-file-upload-btn",onClick:()=>(()=>{const e={altText:i,position:d,showCaption:o};l&&t.update((()=>{l.update(e)})),n()})(),children:"Confirm"})})]})}function D({src:w,altText:E,nodeKey:k,width:y,height:I,showCaption:_,caption:D,position:F}){const[B,K]=t(),P=a.useRef(null),L=a.useRef(null),[A,U,q]=s(k),[J]=n(),[O,W]=a.useState(null),Y=a.useRef(null),Z=a.useCallback((e=>{const t=l();if(A&&i(t)){e.preventDefault(),A&&i(t)&&J.update((()=>{t.getNodes().forEach((e=>{r(e)&&e.remove()}))}))}return!1}),[J,A]),z=a.useCallback((e=>{const t=l(),a=L.current;if(A&&i(t)&&1===t.getNodes().length){if(_)return o(null),e.preventDefault(),D.focus(),!0;if(null!==a&&a!==document.activeElement)return e.preventDefault(),a.focus(),!0}return!1}),[D,A,_]),G=a.useCallback((e=>(Y.current===D||L.current===e.target)&&(o(null),J.update((()=>{U(!0);const e=J.getRootElement();null!==e&&e.focus()})),!0)),[D,J,U]);a.useEffect((()=>{let e=!0;const t=c(J.registerUpdateListener((({editorState:t})=>{e&&W(t.read((()=>l())))})),J.registerCommand(f,((e,t)=>(Y.current=t,!1)),u),J.registerCommand(x,(e=>{const t=e;return t.target===P.current&&(t.shiftKey?U(!A):(q(),U(!0)),!0)}),u),J.registerCommand(g,(e=>e.target===P.current&&(e.preventDefault(),!0)),u),J.registerCommand(p,Z,u),J.registerCommand(h,Z,u),J.registerCommand(m,z,u),J.registerCommand(d,G,u));return()=>{e=!1,t()}}),[q,J,A,k,Z,z,G,U]);const H=A&&i(O),M=A;return e.jsxs(a.Suspense,{fallback:null,children:[e.jsxs(e.Fragment,{children:[e.jsxs("span",{draggable:H,children:[e.jsx("button",{className:"image-edit-button",ref:L,onClick:()=>{K("Update Inline Image",(t=>e.jsx(T,{activeEditor:J,nodeKey:k,onClose:t})))},children:"Edit"}),e.jsx(R,{className:M?"focused "+(i(O)?"draggable":""):null,src:w,altText:E,imageRef:P,width:y,height:I,position:F})]}),_&&e.jsx("span",{className:"image-caption-container",children:e.jsxs(S,{initialEditor:D,children:[e.jsx(j,{}),e.jsx(C,{}),e.jsx(b,{contentEditable:e.jsx(v,{placeholder:"Enter a caption...",placeholderClassName:"InlineImageNode__placeholder",className:"InlineImageNode__contentEditable"}),ErrorBoundary:N})]})})]}),B]})}export{T as UpdateInlineImageDialog,D as default};
