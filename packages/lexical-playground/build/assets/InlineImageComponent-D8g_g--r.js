import{j as e,a4 as y,r as l,l as k,u as P,b as I,c as j,a5 as $,w as R,m as B,K,p as x,y as F,o as Y,q as U,D as G,s as W,S as q,J as z,O as H,Z as J,_ as Z,a0 as Q,$ as V,a6 as X,a7 as ee,B as te}from"./main-BKZv2Ef8.js";import{L as ne}from"./LexicalNestedComposer-BPZPKhnp.js";function ae({children:n,label:c,className:a,...f}){return e.jsxs("div",{className:"Input__wrapper",children:[e.jsx("label",{style:{marginTop:"-1em"},className:"Input__label",children:c}),e.jsx("select",{...f,className:a||"select",children:n})]})}const L=new Set;function se(n){if(!L.has(n))throw new Promise(c=>{const a=new Image;a.src=n,a.onload=()=>{L.add(n),c(null)}})}function le({altText:n,className:c,imageRef:a,src:f,width:u,height:m,position:d}){return se(f),e.jsx("img",{className:c||void 0,src:f,alt:n,ref:a,"data-position":d,style:{display:"block",height:m,width:u},draggable:"false"})}function oe({activeEditor:n,nodeKey:c,onClose:a}){const u=n.getEditorState().read(()=>V(c)),[m,d]=l.useState(u.getAltText()),[N,_]=l.useState(u.getShowCaption()),[S,C]=l.useState(u.getPosition()),E=g=>{_(g.target.checked)},o=g=>{C(g.target.value)},p=()=>{const g={altText:m,position:S,showCaption:N};u&&n.update(()=>{u.update(g)}),a()};return e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginBottom:"1em"},children:e.jsx(X,{label:"Alt Text",placeholder:"Descriptive alternative text",onChange:d,value:m,"data-test-id":"image-modal-alt-text-input"})}),e.jsxs(ae,{style:{marginBottom:"1em",width:"208px"},value:S,label:"Position",name:"position",id:"position-select",onChange:o,children:[e.jsx("option",{value:"left",children:"Left"}),e.jsx("option",{value:"right",children:"Right"}),e.jsx("option",{value:"full",children:"Full Width"})]}),e.jsxs("div",{className:"Input__wrapper",children:[e.jsx("input",{id:"caption",type:"checkbox",checked:N,onChange:E}),e.jsx("label",{htmlFor:"caption",children:"Show Caption"})]}),e.jsx(ee,{children:e.jsx(te,{"data-test-id":"image-modal-file-upload-btn",onClick:()=>p(),children:"Confirm"})})]})}function ce({src:n,altText:c,nodeKey:a,width:f,height:u,showCaption:m,caption:d,position:N}){const[_,S]=y(),C=l.useRef(null),E=l.useRef(null),[o,p,g]=k(a),[t]=P(),[v,O]=l.useState(null),A=l.useRef(null),b=l.useCallback(i=>{const r=I();return o&&j(r)&&(i.preventDefault(),o&&j(r)&&t.update(()=>{r.getNodes().forEach(h=>{$(h)&&h.remove()})})),!1},[t,o]),D=l.useCallback(i=>{const r=I(),s=E.current;if(o&&j(r)&&r.getNodes().length===1){if(m)return R(null),i.preventDefault(),d.focus(),!0;if(s!==null&&s!==document.activeElement)return i.preventDefault(),s.focus(),!0}return!1},[d,o,m]),M=l.useCallback(i=>A.current===d||E.current===i.target?(R(null),t.update(()=>{p(!0);const r=t.getRootElement();r!==null&&r.focus()}),!0):!1,[d,t,p]);l.useEffect(()=>{let i=!0;const r=B(t.registerUpdateListener(({editorState:s})=>{i&&O(s.read(()=>I()))}),t.registerCommand(q,(s,h)=>(A.current=h,!1),x),t.registerCommand(W,s=>{const h=s;return h.target===C.current?(h.shiftKey?p(!o):(g(),p(!0)),!0):!1},x),t.registerCommand(G,s=>s.target===C.current?(s.preventDefault(),!0):!1,x),t.registerCommand(U,b,x),t.registerCommand(Y,b,x),t.registerCommand(F,D,x),t.registerCommand(K,M,x));return()=>{i=!1,r()}},[g,t,o,a,b,D,M,p]);const T=o&&j(v),w=o;return e.jsxs(l.Suspense,{fallback:null,children:[e.jsxs(e.Fragment,{children:[e.jsxs("span",{draggable:T,children:[e.jsx("button",{className:"image-edit-button",ref:E,onClick:()=>{S("Update Inline Image",i=>e.jsx(oe,{activeEditor:t,nodeKey:a,onClose:i}))},children:"Edit"}),e.jsx(le,{className:w?`focused ${j(v)?"draggable":""}`:null,src:n,altText:c,imageRef:C,width:f,height:u,position:N})]}),m&&e.jsx("span",{className:"image-caption-container",children:e.jsxs(ne,{initialEditor:d,children:[e.jsx(z,{}),e.jsx(H,{}),e.jsx(J,{contentEditable:e.jsx(Z,{placeholder:"Enter a caption...",placeholderClassName:"InlineImageNode__placeholder",className:"InlineImageNode__contentEditable"}),ErrorBoundary:Q})]})})]}),_]})}export{oe as UpdateInlineImageDialog,ce as default};
