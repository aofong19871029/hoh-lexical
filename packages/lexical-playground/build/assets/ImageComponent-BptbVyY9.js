import{r as e,k as t,o as a,u as s,O as r,x as n,p as o,q as i,y as l,b as d,a as c,F as h,T as u,m,w as g,s as v,n as x,e as p,t as f,v as j,j as w,z as C,X as E,A as b,C as N,D as R,G as S,H as y,I as V,J as z,N as H,P as k,Q as I,R as W,U as T,_ as D,V as G,W as L,Y as M,Z as _,a0 as A,a1 as B,a2 as F,S as K}from"./main-CGNrK9TK.js";import{d as U}from"./LexicalNestedComposer-iPxZfwmB.js";import{I as P}from"./ImageResizer-Bmjbc7sL.js";const q="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='utf-8'?%3e%3c!--%20Uploaded%20to:%20SVG%20Repo,%20www.svgrepo.com,%20Generator:%20SVG%20Repo%20Mixer%20Tools%20--%3e%3csvg%20width='800px'%20height='800px'%20viewBox='0%200%2024%2024'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M22%203H2v18h20v-2h-2v-2h2v-2h-2v-2h2v-2h-2V9h2V7h-2V5h2V3zm-2%204v2h-2v2h2v2h-2v2h2v2h-2v2H4V5h14v2h2zm-6%202h-2v2h-2v2H8v2H6v2h2v-2h2v-2h2v-2h2v2h2v-2h-2V9zM6%207h2v2H6V7z'%20fill='%23000000'/%3e%3c/svg%3e",J=new Set,O=F();function Q({altText:e,className:t,imageRef:a,src:s,width:r,height:n,maxWidth:o,onError:i}){return function(e){if(!J.has(e))throw new Promise((t=>{const a=new Image;a.src=e,a.onload=()=>{J.add(e),t(null)},a.onerror=()=>{J.add(e)}}))}(s),w.jsx("img",{className:t||void 0,src:s,alt:e,ref:a,style:{height:n,maxWidth:o,width:r},onError:i,draggable:"false"})}function X(){return w.jsx("img",{src:q,style:{height:200,opacity:.2,width:200},draggable:"false"})}function Y({src:F,altText:q,nodeKey:J,width:Y,height:Z,maxWidth:$,resizable:ee,showCaption:te,caption:ae,captionsEnabled:se}){const re=e.useRef(null),ne=e.useRef(null),[oe,ie,le]=t(J),[de,ce]=e.useState(!1),{isCollabActive:he}=a(),[ue]=s(),[me,ge]=e.useState(null),ve=e.useRef(null),[xe,pe]=e.useState(!1),fe=e.useCallback((e=>{const t=r();if(oe&&n(t)){e.preventDefault(),ue.update((()=>{t.getNodes().forEach((e=>{o(e)&&e.remove()}))}))}return!1}),[ue,oe]),je=e.useCallback((e=>{const t=r(),a=ne.current;if(oe&&n(t)&&1===t.getNodes().length){if(te)return i(null),e.preventDefault(),ae.focus(),!0;if(null!==a&&a!==document.activeElement)return e.preventDefault(),a.focus(),!0}return!1}),[ae,oe,te]),we=e.useCallback((e=>(ve.current===ae||ne.current===e.target)&&(i(null),ue.update((()=>{ie(!0);const e=ue.getRootElement();null!==e&&e.focus()})),!0)),[ae,ue,ie]),Ce=e.useCallback((e=>{const t=e;return!!de||t.target===re.current&&(t.shiftKey?ie(!oe):(le(),ie(!0)),!0)}),[de,oe,ie,le]),Ee=e.useCallback((e=>{ue.getEditorState().read((()=>{const t=r();"IMG"===e.target.tagName&&l(t)&&1===t.getNodes().length&&ue.dispatchCommand(O,e)}))}),[ue]);e.useEffect((()=>{let e=!0;const t=ue.getRootElement(),a=d(ue.registerUpdateListener((({editorState:t})=>{e&&ge(t.read((()=>r())))})),ue.registerCommand(p,((e,t)=>(ve.current=t,!1)),h),ue.registerCommand(x,Ce,h),ue.registerCommand(O,Ce,h),ue.registerCommand(v,(e=>e.target===re.current&&(e.preventDefault(),!0)),h),ue.registerCommand(g,fe,h),ue.registerCommand(m,fe,h),ue.registerCommand(u,je,h),ue.registerCommand(c,we,h));return null==t||t.addEventListener("contextmenu",Ee),()=>{e=!1,a(),null==t||t.removeEventListener("contextmenu",Ee)}}),[le,ue,de,oe,J,fe,je,we,Ce,Ee,ie]);const{historyState:be}=f(),{settings:{showNestedEditorTreeView:Ne}}=j(),Re=oe&&n(me)&&!de,Se=oe||de;return w.jsx(e.Suspense,{fallback:null,children:w.jsxs(w.Fragment,{children:[w.jsx("div",{draggable:Re,children:xe?w.jsx(X,{}):w.jsx(Q,{className:Se?"focused "+(n(me)?"draggable":""):null,src:F,altText:q,imageRef:re,width:Y,height:Z,maxWidth:$,onError:()=>pe(!0)})}),te&&w.jsx("div",{className:"image-caption-container",children:w.jsxs(U,{initialEditor:ae,initialNodes:[C,E,b,N,R,S,y,V],children:[w.jsx(z,{}),w.jsx(H,{}),w.jsx(k,{}),w.jsx(I,{}),w.jsx(W,{}),w.jsx(T,{}),he?w.jsx(D,{id:ae.getKey(),providerFactory:G,shouldBootstrap:!0}):w.jsx(L,{externalHistoryState:be}),w.jsx(M,{contentEditable:w.jsx(_,{placeholder:"Enter a caption...",placeholderClassName:"ImageNode__placeholder",className:"ImageNode__contentEditable"}),ErrorBoundary:A}),!0===Ne?w.jsx(B,{}):null]})}),ee&&n(me)&&Se&&w.jsx(P,{showCaption:te,setShowCaption:()=>{ue.update((()=>{const e=K(J);o(e)&&e.setShowCaption(!0)}))},editor:ue,buttonRef:ne,imageRef:re,maxWidth:$,onResizeStart:()=>{ce(!0)},onResizeEnd:(e,t)=>{setTimeout((()=>{ce(!1)}),200),ue.update((()=>{const a=K(J);o(a)&&a.setWidthAndHeight(e,t)}))},captionsEnabled:!xe&&se})]})})}export{O as RIGHT_CLICK_IMAGE_COMMAND,Y as default};
