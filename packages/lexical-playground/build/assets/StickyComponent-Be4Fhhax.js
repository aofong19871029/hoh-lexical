import{ab as P,r as f,ac as S,u as _,t as z,z as w,j as r,a3 as L,W as B,X,Y,ad as T,_ as $,a0 as W,$ as E,ae as x}from"./main-0eG-CwhZ.js";import{L as H}from"./LexicalNestedComposer-6JIAoIkj.js";const O=P?f.useLayoutEffect:f.useEffect,A=O,M={...S,paragraph:"StickyEditorTheme__paragraph"};function C(p,a){const u=p.style,d=a.rootElementRect,m=d!==null?d.left:0,c=d!==null?d.top:0;u.top=c+a.y+"px",u.left=m+a.x+"px"}function I({x:p,y:a,nodeKey:u,color:d,caption:m}){const[c]=_(),l=f.useRef(null),g=f.useRef({isDragging:!1,offsetX:0,offsetY:0,rootElementRect:null,x:0,y:0}),{isCollabActive:b}=z();f.useEffect(()=>{const e=g.current;e.x=p,e.y=a;const o=l.current;o!==null&&C(o,e)},[p,a]),A(()=>{const e=g.current,o=new ResizeObserver(s=>{for(let i=0;i<s.length;i++){const y=s[i],{target:D}=y;e.rootElementRect=D.getBoundingClientRect();const v=l.current;v!==null&&C(v,e)}}),t=c.registerRootListener((s,i)=>{i!==null&&o.unobserve(i),s!==null&&o.observe(s)}),n=()=>{const s=c.getRootElement(),i=l.current;s!==null&&i!==null&&(e.rootElementRect=s.getBoundingClientRect(),C(i,e))};return window.addEventListener("resize",n),()=>{window.removeEventListener("resize",n),t()}},[c]),f.useEffect(()=>{const e=l.current;e!==null&&setTimeout(()=>{e.style.setProperty("transition","top 0.3s ease 0s, left 0.3s ease 0s")},500)},[]);const h=e=>{const o=l.current,t=g.current,n=t.rootElementRect,s=L(o);o!==null&&t.isDragging&&n!==null&&(t.x=e.pageX/s-t.offsetX-n.left,t.y=e.pageY/s-t.offsetY-n.top,C(o,t))},k=e=>{const o=l.current,t=g.current;o!==null&&(t.isDragging=!1,o.classList.remove("dragging"),c.update(()=>{const n=E(u);x(n)&&n.setPosition(t.x,t.y)})),document.removeEventListener("pointermove",h),document.removeEventListener("pointerup",k)},R=()=>{c.update(()=>{const e=E(u);x(e)&&e.remove()})},N=()=>{c.update(()=>{const e=E(u);x(e)&&e.toggleColor()})},{historyState:j}=w();return r.jsx("div",{ref:l,className:"sticky-note-container",children:r.jsxs("div",{className:`sticky-note ${d}`,onPointerDown:e=>{const o=l.current;if(o==null||e.button===2||e.target!==o.firstChild)return;const t=o,n=g.current;if(t!==null){const{top:s,left:i}=t.getBoundingClientRect(),y=L(t);n.offsetX=e.clientX/y-i,n.offsetY=e.clientY/y-s,n.isDragging=!0,t.classList.add("dragging"),document.addEventListener("pointermove",h),document.addEventListener("pointerup",k),e.preventDefault()}},children:[r.jsx("button",{onClick:R,className:"delete","aria-label":"Delete sticky note",title:"Delete",children:"X"}),r.jsx("button",{onClick:N,className:"color","aria-label":"Change sticky note color",title:"Color",children:r.jsx("i",{className:"bucket"})}),r.jsxs(H,{initialEditor:m,initialTheme:M,children:[b?r.jsx(B,{id:m.getKey(),providerFactory:X,shouldBootstrap:!0}):r.jsx(Y,{externalHistoryState:j}),r.jsx(T,{contentEditable:r.jsx($,{placeholder:"What's up?",placeholderClassName:"StickyNode__placeholder",className:"StickyNode__contentEditable"}),ErrorBoundary:W})]})]})})}export{I as default};
