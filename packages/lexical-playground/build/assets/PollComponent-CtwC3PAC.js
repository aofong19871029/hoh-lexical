import{u as E,r as p,l as S,b as P,c as j,a8 as O,m as b,o as D,p as f,q as I,s as $,j as t,B as M,t as A,a9 as k,$ as R,aa as y}from"./main-BKZv2Ef8.js";function L(n){return n.reduce((a,c)=>a+c.votes.length,0)}function V({option:n,index:a,options:c,totalVotes:s,withPollNode:_}){const{clientID:r}=A(),m=p.useRef(null),x=n.votes,h=x.indexOf(r)!==-1,i=x.length,N=n.text;return t.jsxs("div",{className:"PollNode__optionContainer",children:[t.jsx("div",{className:k("PollNode__optionCheckboxWrapper",h&&"PollNode__optionCheckboxChecked"),children:t.jsx("input",{ref:m,className:"PollNode__optionCheckbox",type:"checkbox",onChange:d=>{_(l=>{l.toggleVote(n,r)})},checked:h})}),t.jsxs("div",{className:"PollNode__optionInputWrapper",children:[t.jsx("div",{className:"PollNode__optionInputVotes",style:{width:`${i===0?0:i/s*100}%`}}),t.jsx("span",{className:"PollNode__optionInputVotesCount",children:i>0&&(i===1?"1 vote":`${i} votes`)}),t.jsx("input",{className:"PollNode__optionInput",type:"text",value:N,onChange:d=>{const l=d.target,C=l.value,e=l.selectionStart,o=l.selectionEnd;_(u=>{u.setOptionText(n,C)},()=>{l.selectionStart=e,l.selectionEnd=o})},placeholder:`Option ${a+1}`})]}),t.jsx("button",{disabled:c.length<3,className:k("PollNode__optionDelete",c.length<3&&"PollNode__optionDeleteDisabled"),"aria-label":"Remove",onClick:()=>{_(d=>{d.deleteOption(n)})}})]})}function K({question:n,options:a,nodeKey:c}){const[s]=E(),_=p.useMemo(()=>L(a),[a]),[r,m,x]=S(c),[g,h]=p.useState(null),i=p.useRef(null),N=p.useCallback(e=>{const o=P();return r&&j(o)&&(e.preventDefault(),s.update(()=>{o.getNodes().forEach(v=>{O(v)&&v.remove()})})),!1},[s,r]);p.useEffect(()=>b(s.registerUpdateListener(({editorState:e})=>{h(e.read(()=>P()))}),s.registerCommand($,e=>{const o=e;return o.target===i.current?(o.shiftKey||x(),m(!r),!0):!1},f),s.registerCommand(I,N,f),s.registerCommand(D,N,f)),[x,s,r,c,N,m]);const d=(e,o)=>{s.update(()=>{const u=R(c);O(u)&&e(u)},{onUpdate:o})},l=()=>{d(e=>{e.addOption(y())})},C=j(g)&&r;return t.jsx("div",{className:`PollNode__container ${C?"focused":""}`,ref:i,children:t.jsxs("div",{className:"PollNode__inner",children:[t.jsx("h2",{className:"PollNode__heading",children:n}),a.map((e,o)=>{const u=e.uid;return t.jsx(V,{withPollNode:d,option:e,index:o,options:a,totalVotes:_},u)}),t.jsx("div",{className:"PollNode__footer",children:t.jsx(M,{onClick:l,small:!0,children:"Add Option"})})]})})}export{K as default};
