import{r as n,l as Q,t as X,u as Z,b as N,c as C,v as A,w as k,x as ee,m as te,K as se,p as u,y as ae,o as ne,q as oe,D as re,s as ie,S as le,z as ce,A as ue,j as s,R as de,T as ge,L as me,P as fe,F as he,G as Ce,H as ve,I as Ee,J as xe,N as Ne,O as pe,Q as Se,U as Re,V as Me,W as _e,X as je,Y as Ie,Z as be,_ as Ae,a0 as Le,a1 as we,a2 as De,$ as O}from"./main-ExklfRWc.js";import{L as Pe}from"./LexicalNestedComposer-vjJmVL3r.js";import{I as ye}from"./ImageResizer-BbkROhX3.js";const He="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='utf-8'?%3e%3c!--%20Uploaded%20to:%20SVG%20Repo,%20www.svgrepo.com,%20Generator:%20SVG%20Repo%20Mixer%20Tools%20--%3e%3csvg%20width='800px'%20height='800px'%20viewBox='0%200%2024%2024'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M22%203H2v18h20v-2h-2v-2h2v-2h-2v-2h2v-2h-2V9h2V7h-2V5h2V3zm-2%204v2h-2v2h2v2h-2v2h2v2h-2v2H4V5h14v2h2zm-6%202h-2v2h-2v2H8v2H6v2h2v-2h2v-2h2v-2h2v2h2v-2h-2V9zM6%207h2v2H6V7z'%20fill='%23000000'/%3e%3c/svg%3e",L=new Set,V=De("RIGHT_CLICK_IMAGE_COMMAND");function Te(l){if(!L.has(l))throw new Promise(f=>{const o=new Image;o.src=l,o.onload=()=>{L.add(l),f(null)},o.onerror=()=>{L.add(l)}})}function ke({altText:l,className:f,imageRef:o,src:v,width:p,height:E,maxWidth:S,onError:d}){return Te(v),s.jsx("img",{className:f||void 0,src:v,alt:l,ref:o,style:{height:E,maxWidth:S,width:p},onError:d,draggable:"false"})}function Oe(){return s.jsx("img",{src:He,style:{height:200,opacity:.2,width:200},draggable:"false"})}function Ke({src:l,altText:f,nodeKey:o,width:v,height:p,maxWidth:E,resizable:S,showCaption:d,caption:g,captionsEnabled:z}){const x=n.useRef(null),R=n.useRef(null),[i,m,M]=Q(o),[h,w]=n.useState(!1),{isCollabActive:G}=X(),[t]=Z(),[_,K]=n.useState(null),D=n.useRef(null),[P,$]=n.useState(!1),j=n.useCallback(a=>{const e=N();return i&&C(e)&&(a.preventDefault(),t.update(()=>{e.getNodes().forEach(c=>{A(c)&&c.remove()})})),!1},[t,i]),y=n.useCallback(a=>{const e=N(),r=R.current;if(i&&C(e)&&e.getNodes().length===1){if(d)return k(null),a.preventDefault(),g.focus(),!0;if(r!==null&&r!==document.activeElement)return a.preventDefault(),r.focus(),!0}return!1},[g,i,d]),H=n.useCallback(a=>D.current===g||R.current===a.target?(k(null),t.update(()=>{m(!0);const e=t.getRootElement();e!==null&&e.focus()}),!0):!1,[g,t,m]),I=n.useCallback(a=>{const e=a;return h?!0:e.target===x.current?(e.shiftKey?m(!i):(M(),m(!0)),!0):!1},[h,i,m,M]),b=n.useCallback(a=>{t.getEditorState().read(()=>{const e=N();a.target.tagName==="IMG"&&ee(e)&&e.getNodes().length===1&&t.dispatchCommand(V,a)})},[t]);n.useEffect(()=>{let a=!0;const e=t.getRootElement(),r=te(t.registerUpdateListener(({editorState:c})=>{a&&K(c.read(()=>N()))}),t.registerCommand(le,(c,J)=>(D.current=J,!1),u),t.registerCommand(ie,I,u),t.registerCommand(V,I,u),t.registerCommand(re,c=>c.target===x.current?(c.preventDefault(),!0):!1,u),t.registerCommand(oe,j,u),t.registerCommand(ne,j,u),t.registerCommand(ae,y,u),t.registerCommand(se,H,u));return e==null||e.addEventListener("contextmenu",b),()=>{a=!1,r(),e==null||e.removeEventListener("contextmenu",b)}},[M,t,h,i,o,j,y,H,I,b,m]);const B=()=>{t.update(()=>{const a=O(o);A(a)&&a.setShowCaption(!0)})},Y=(a,e)=>{setTimeout(()=>{w(!1)},200),t.update(()=>{const r=O(o);A(r)&&r.setWidthAndHeight(a,e)})},F=()=>{w(!0)},{historyState:U}=ce(),{settings:{showNestedEditorTreeView:W}}=ue(),q=i&&C(_)&&!h,T=i||h;return s.jsx(n.Suspense,{fallback:null,children:s.jsxs(s.Fragment,{children:[s.jsx("div",{draggable:q,children:P?s.jsx(Oe,{}):s.jsx(ke,{className:T?`focused ${C(_)?"draggable":""}`:null,src:l,altText:f,imageRef:x,width:v,height:p,maxWidth:E,onError:()=>$(!0)})}),d&&s.jsx("div",{className:"image-caption-container",children:s.jsxs(Pe,{initialEditor:g,initialNodes:[de,ge,me,fe,he,Ce,ve,Ee],children:[s.jsx(xe,{}),s.jsx(Ne,{}),s.jsx(pe,{}),s.jsx(Se,{}),s.jsx(Re,{}),s.jsx(Me,{}),G?s.jsx(_e,{id:g.getKey(),providerFactory:je,shouldBootstrap:!0}):s.jsx(Ie,{externalHistoryState:U}),s.jsx(be,{contentEditable:s.jsx(Ae,{placeholder:"Enter a caption...",placeholderClassName:"ImageNode__placeholder",className:"ImageNode__contentEditable"}),ErrorBoundary:Le}),W===!0?s.jsx(we,{}):null]})}),S&&C(_)&&T&&s.jsx(ye,{showCaption:d,setShowCaption:B,editor:t,buttonRef:R,imageRef:x,maxWidth:E,onResizeStart:F,onResizeEnd:Y,captionsEnabled:!P&&z})]})})}export{V as RIGHT_CLICK_IMAGE_COMMAND,Ke as default};
